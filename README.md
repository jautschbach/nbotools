# NBOTools 

Utility Software for NBO Calculations

Author: Augustine Obeng, University at Buffalo, SUNY, J. Autschbach research group

(The parse-namelists code, included in the repository, was written by Jochen Autschbach, University at Buffalo, SUNY)

Literature: https://doi.org/10.26434/chemrxiv-2025-csjxr-v2


## Overview

NBOTools is a Python script (`main.py` in directory `packages`) designed to parse and analyze output and data files from Natural Bond Orbital (NBO) calculations. The script can perform various analyses, such as  running orthogonality tests, checking energy differences, solving generalized eigenvalue equations in reduced sets of atomic orbitals, and provides a menu-driven interface for additional computations such as transformed orbital energies, core-valence orthogonalization, orbital transformations and localizations, and bond order analyses. NBOTools places emphasis on utilizing pre-orthogonal NAOS (pNAOs or PNAOs) generated in NBO runs.

The repository also contains, under directory `tools`, a Python script and an accompanying Fortran code `parse-namelists` for checks of NBO `.47` input files, to make sure NBOTools can handle the basis set specifications. Further comments can be found below. 

## Prerequisites

- Ensure Python 3.x is installed.
- NBOTools requires NBO (version 6 or 7) plot files generated by an NBO run with the `$NBO PLOT FILE=FILENAME $END` keywords. Other NBO versions may work fine, too, but this has not been tested extensively.
- The working directory must contain *exactly one* `.47` file to avoid potentially serious problems.


## Features

The script provides the following functionality via an interactive menu:

* `Transform Orbital Energies`: Computes energies such as AOMO energies.
* `Orbital Transformations`: Performs transformations like AOMO.
* `Operator Matrices`: Retrieves matrices, such as the Fock matrix in the AO basis (if available).
* `Orbitals in PNAO Basis`: Computes orbitals in the PNAO basis (e.g., PNAOMO).
* `Energies in PNAO Basis`: Calculates orbital energies in the PNAO basis (e.g., PNAOMO energy).
* `Localize Orbitals`: Performs Pipek-Mezey orbital localization.
* `Bond Order Analysis`: Bond order analysis based on NBO data.
* `Generalized Eigenvalue Equation Solver`: Solves generalized eigenvalue equations.
0. `Exit`: Terminates the program.

*AOPNAO Matrix Options:* When processing the NBO files, NBOTools offers two options for handling the AOPNAO matrix:

1. Use the NBO-generated AOPNAO (PNAOs in AO basis).
2. Reconstruct AOPNAO from AONAO. SPNAO (Overlap matrix in the PNAO basis) will also be recalculated, which may slightly differ from NBO-generated AOPNAO/SPNAO.

A standalone script `nao2pnao.py` is provided if one wishes to visualize the reconstructed PNAOs.


### Additional Features

- `Orthogonality Tests`: Checks the orthogonality of calculated orbitals.
- `Energy Difference Checks`: Analyzes energy differences for validation.

NBOTools supports data sets containing separate alpha/beta spin data (e.g., from spin-unrestricted DFT calculations).

## Usage

1. Prepare the Directory:

   - Ensure the working directory contains exactly one .47 file generated from an NBO run.
   - The NBO PLOT files should be created with the `$NBO PLOT FILE=FILENAME $END` keywords.
   - Example directory structure:

     ```
     /path/to/directory/
     ├── FILENAME.31
     ├── FILENAME.32
     ├── FILENAME.33
     ├── FILENAME.34
     ├── FILENAME.35
     ├── FILENAME.36
     ├── FILENAME.37
     ├── FILENAME.38
     ├── FILENAME.39
     ├── FILENAME.40
     ├── FILENAME.41
     ├── FILENAME.42
     ├── FILENAME.46
     └── FILENAME.47
     ```

2. Run NBOTools:

   `python3 main.py`
   
   The script will:

   - Parse the NBO data files.
   - Display the current working directory and calculation type (e.g., open shell).
   - Notify you if the Fock matrix is unavailable, which restrictts certain features.
   - Prompt for AOPNAO matrix options (see above).

3. Interact with the Menu:

   - After processing the NBO data files, NBOTools presents the menu.
   - Enter a number (0–8) to select an option.
   - Follow additional prompts for specific calculations or analyses.

4. If you want to test the `.47` file basis set conventions, use the `parse-namelist` code under `tools`. There are several `.47` files provided under directory `tools/file47-examples`. `cd` to this directory and convert the `.47` data to a Fortran namelist input by running  
`python3 ../convert-47-to-namelists.py <file.47>`  
which will create a file `file.namelists`. Assuming that the Fortran code in `../parse-namelists` has been compiled (e.g., with `gfortran`, type `make`), you can now run it with the `.namelists` file like this:  
`../parse-namelists/parse-namelists < file.namelists`  
The program will output information about the basis set and other data that were present in the `.47` file and attempt to calculate the overlap matrix and compare it to the original overlap matrix from the `.47` file. If those are not the saame within tight numerical thresholds, you will likely not be able to run NBOTools or the accompanying nbo2cube software (https://github.com/jautschbach/nbo2cube) without encountering problems. Likewise, if `parse-namelists` exits with an error prior to generating the overlap matrix, it is probably not safe to use
the corresponding `.47` file with NBOTools or nbo2cube.



## Notes

- If the Fock matrix is unavailable, certain analyses are not available.
- File Restrictions: Ensure only one `.47` file exists in the directory to avoid parsing errors.
- Recalculation of PNAOs: Choosing option 2 for PNAO reconstruction may yield a slightly different SPNAO overlap matrix compared to the NBO-generated data.


